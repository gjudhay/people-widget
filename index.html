<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Project Feedback Widget</title>
</head>

<body>
  <h3>Project Feedback Widget</h3>

  <label>Filled By (Email)</label>
  <input id="filledBy" readonly />

  <label>User Name</label>
  <input id="userName" readonly />

  <label>Project Name</label>
  <select id="project">
    <option>Select Project</option>
    <!-- Add dynamic options here -->
  </select>

  <label>Job Name</label>
  <select id="job">
    <option>Select Project First</option>
    <!-- Add dynamic options here -->
  </select>

  <button id="submitBtn">Submit</button>

  <div id="msg"></div>

  <script src="https://static.zohocdn.com/zp5/widgets/zpwidgetsdk.min.js"></script>

  <script>
    ZOHO.embeddedApp.on("PageLoad", function () {
      const loginEmail = new URLSearchParams(window.location.search).get("email") || "";
      document.getElementById("filledBy").value = loginEmail;

      if (!loginEmail) {
        document.getElementById("msg").innerText =
          "Email not received. Check widget URL is like: ...index.html?email=${Curr_User.EMAIL}";
        return;
      }

      // Fetch employee name from Zoho People using EmailID
      const inputData = {
        formName: "Employee", // Confirm this matches your form name
        criteria: `(EmailID:equals:${loginEmail})` // Use EmailID from your form
      };

      ZOHO.People.API.getRecords(inputData).then(function (response) {
        console.log("Employee response:", response); // Debugging

        if (response && response.data && response.data.length > 0) {
          const employee = response.data[0];
          const firstName = employee["FirstName"] || "";
          const lastName = employee["LastName"] || "";
          const fullName = `${firstName} ${lastName}`.trim();
          document.getElementById("userName").value = fullName || "Name not available";
        } else {
          document.getElementById("msg").innerText = "No employee found for this email.";
        }
      }).catch(function (error) {
        console.error("Error fetching employee:", error);
        document.getElementById("msg").innerText = "Error fetching employee details.";
      });
    });

    ZOHO.embeddedApp.init();
  </script>
</body>
</html>
